<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
      
       <record id="mrp_production_form_view_inherit" model="ir.ui.view">
            <field name="name">mrp.production.form.inherit</field>
            <field name="model">mrp.production</field>
            <field name="inherit_id" ref="mrp.mrp_production_form_view"/>
            <field name="arch" type="xml">

                <xpath expr="//button[@name='action_cancel']" position="before">
                  <button type="object" name='button_maintenance_req' string="Demande de Maintenance"/>
                </xpath>

                <xpath expr="//div[@name='button_box']" position="inside">
                    <button name="open_maintenance_request_mo"
                            type="object" class="oe_stat_button"
                            icon="fa-wrench"
                            attrs="{'invisible': [('maintenance_count', '=', 0)]}"
                            context="{'search_default_production_id': active_id}">
                      <div class="o_field_widget o_stat_info">
                          <span class="o_stat_value"><field name="maintenance_count"/></span>
                          <span class="o_stat_text">Maintenance</span>
                      </div>
                    </button>
                </xpath>

                 <xpath expr="//button[@name='button_unbuild']" position="after">
                    <button name="button_cancel"
                            attrs="{'invisible': [('state','!=','done')]}"
                            type="object"
                            string="Annuler"
                            confirm="Voulez-vous vraiment annuler cet ordre de fabrication?" />
                </xpath>

                <xpath expr="//header/button[@name='button_unbuild']" position="before">
                    <button name="btn_split_mo"
                            string="Diviser l'ordre de fabrication"
                            type="object"
                            class="btn-primary"
                            attrs="{'invisible': [('state', '!=', 'confirmed')]}"/>
                </xpath>

                <div name="button_box" position="inside">
                    <button name="list_split_orders"
                            class="oe_stat_button"
                            icon="fa-code-fork"
                            type="object"
                            attrs="{'invisible': [('split_mo_count', '=', 0)]}">
                        <field name="split_mo_count" string="Ordres divisÃ©s" widget="statinfo"/>
                    </button>
                </div>
                
            </field>
        </record>

       
         <!-- Ordre de fabrication pour la vue de planification -->
        <record id="mrp_production_tree_view_planning" model="ir.ui.view">
            <field name="name">mrp.production.tree.inherit.planning</field>
            <field name="model">mrp.production</field>
            <field name="arch" type="xml">
                <tree default_order="date_planned_start asc" decoration-info="state=='confirmed'" decoration-danger="date_planned_start&lt;current_date and state not in ('done','cancel')" decoration-muted="state in ('done','cancel')" string="Manufacturing Orders" name="Production">
                    <field name="message_needaction" invisible="1"/>
                    <field name="name"/>
                    <field name="date_planned_start"/>
                    <field name="product_id"/>
                    <field name="product_qty" sum="Total Qty" string="Quantity"/>
                    <field name="product_uom_id" string="Unit of Measure" options="{'no_open':True,'no_create':True}" groups="uom.group_uom"/>
                    <field name="reservation_state" string="Availability"/>
                    <field name="origin"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record id="mrp_production_view_search_inherit_planning" model="ir.ui.view">
            <field name="name">mrp.production.search.view.inherit.planning</field>
            <field name="model">mrp.production</field>
            <field name="inherit_id" ref="mrp.view_mrp_production_filter"/>
            <field name="arch" type="xml">
                <filter name="filter_planned" position="attributes">
                    <attribute name="domain">[('is_planned', '=', True), ('date_planned_start', '!=', False), ('date_planned_finished', '!=', False)]</attribute>
                </filter>
            </field>
        </record>

        <record id="production_order_unplan_server_action" model="ir.actions.server">
            <field name="name">Unplan orders</field>
            <field name="model_id" ref="mrp.model_mrp_production"/>
            <field name="binding_model_id" ref="mrp.model_mrp_production" />
            <field name="binding_view_types">list</field>
            <field name="state">code</field>
            <field name="code">records.button_unplan()</field>
        </record>

        <record id="mrp.act_product_mrp_production_workcenter" model="ir.actions.act_window">
            <field name="domain">[('bom_id', '!=', False), ('bom_id.operation_ids.workcenter_id', '=', active_id), ('date_planned_start', '!=', False), ('date_planned_finished', '!=', False)]</field>
            <field name="view_id" ref="mrp_production_tree_view_planning"/>
        </record>

        <menuitem id="mrp_workorder_menu_planning"
            name="Ordres de travail"
            sequence="2"
            parent="mrp.mrp_planning_menu_root"
            groups="mrp.group_mrp_routings"/>
            
        <menuitem id="menu_mrp_workorder_production"
            name="Planning par Production"
            sequence="1"
            action="mrp.action_mrp_workorder_production"
            parent="mrp_workorder_menu_planning"/>

        <menuitem id="menu_mrp_workorder_workcenter"
            name="Planning par poste de charge"
            sequence="2"
            action="mrp.action_mrp_workorder_workcenter"
            parent="mrp_workorder_menu_planning"/>


        
    </data>
</odoo>

